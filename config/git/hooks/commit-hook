#!/usr/bin/env bash
set -euo pipefail

COMMIT_MSG_FILE="$1"
MSG="$(head -n 1 "$COMMIT_MSG_FILE")"

# --- Configurable bits ---

# JIRA pattern like ABC-123, CENTEST-9635, etc.
JIRA_REGEX='[A-Z][A-Z0-9]+-[0-9]+'

# Allow merge commits created by Git (optional but usually nice)
if [[ "$MSG" =~ ^Merge\ branch ]]; then
  exit 0
fi

# Allow revert commits (optional)
if [[ "$MSG" =~ ^Revert ]]; then
  exit 0
fi

# --- Enforcement ---

if echo "$MSG" | grep -Eq "$JIRA_REGEX"; then
  exit 0
fi

echo "âœ– Commit message must include a JIRA ID (e.g. ABC-123) in the subject."
echo "  Got: $MSG"
echo
echo "Examples:"
echo "  feat(ABC-123): add logging redaction"
echo "  fix(PLAT-42): handle null patient IDs"
exit 1
